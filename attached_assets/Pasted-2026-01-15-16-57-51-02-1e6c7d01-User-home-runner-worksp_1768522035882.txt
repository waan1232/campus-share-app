2026-01-15 16:57:51.02
1e6c7d01
User
/home/runner/workspace/dist/index.cjs:70
2026-01-15 16:57:51.02
1e6c7d01
User
`);ls.write(d_.format.apply(d_,e))}}Object.defineProperty(ar.exports,"isWin",{get:function(){return xc},set:function(t){xc=t}});ar.exports.warnTo=function(t){var e=ls;return ls=t,e};ar.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(xc?p_.join(e.APPDATA||"./","postgresql","pgpass.conf"):p_.join(e.HOME||"./",".pgpass"));return r};ar.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:xc?!0:(e=e||"",Qq(t.mode)?t.mode&(Bq|zq)?(Hf('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hf('WARNING: password file "%s" is not a plain file',e),!1))};var Vq=ar.exports.match=function(t,e){return wi.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||Lq)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ar.exports.getPassword=function(t,e,r){var n,i=e.pipe(Fq());function a(u){var c=Gq(u);c&&Kq(c)&&Vq(t,c)&&(n=c[Hq],i.end())}var s=function(){e.destroy(),r(n)},o=function(u){e.destroy(),Hf("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var Gq=ar.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,a=0,s={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[wi[l]]=f},c=0;c=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return s=Object.keys(s).length===Qf?s:null,s},Kq=ar.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},r=0;r{"use strict";var CU=require("path"),m_=require("fs"),bc=f_();Vf.exports=function(t,e){var r=bc.getFileName();m_.stat(r,function(n,i){if(n||!bc.usePgPass(i,r))return e(void 0);var a=m_.createReadStream(r);bc.getPassword(t,a,e)})};Vf.exports.warnTo=bc.warnTo});var x_=h((PU,y_)=>{"use strict";var Wq=require("events").EventEmitter,v_=vi(),Gf=DS(),Zq=dc(),Jq=hf(),g_=WS(),Xq=cs(),Yq=Uf(),ej=df(),wc=class extends Wq{constructor(e){super(),this.connectionParameters=new Jq(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zq(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new Yq({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xq.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{h_()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ej.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Gf.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Gf.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Gf.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return v_.escapeIdentifier(e)}escapeLiteral(e){return v_.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,a,s,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new g_(e,r,n),i.callback||(a=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),s&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};wc.Query=g_;y_.exports=wc});var __=h((IU,S_)=>{"use strict";var tj=require("events").EventEmitter,b_=function(){},w_=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Kf=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Si=class{constructor(e){this.callback=e}};function rj(){throw new Error("Release called on client which has already been released to the pool.")}function Sc(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(s,o){s?r(s):n(o)},a=new t(function(s,o){n=s,r=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function nj(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Wf=class extends tj{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||_c().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=w_(this._idle,a=>a.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=Sc(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Si(r.callback)),n;let i=(o,u,c)=>{clearTimeout(s),r.callback(o,u,c)},a=new Si(i),s=setTimeout(()=>{w_(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),n}return this.newClient(new Si(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=nj(this,r);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(s=>{if(i&&clearTimeout(i),r.on("error",n),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==r),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,b_);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Si((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,b_);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&rj(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Kf(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Sc(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let i=Sc(this.Promise,n);return n=i.callback,this.connect((a,s)=>{if(a)return n(a);let o=!1,u=c=>{o||(o=!0,s.release(c),n(c))};s.once("error",u),this.log("dispatching query");try{s.query(e,r,(c,l)=>{if(this.log("query dispatched"),s.removeListener("error",u),!o)return o=!0,s.release(c),c?n(c):n(void 0,l)})}catch(c){return s.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Sc(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};S_.exports=Wf});var T_=h((NU,k_)=>{"use strict";var E_=require("events").EventEmitter,ij=require("util"),Zf=vi(),_i=k_.exports=function(t,e,r){E_.call(this),t=Zf.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ij.inherits(_i,E_);var aj={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};_i.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=aj[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};_i.prototype.then=function(t,e){return this._getPromise().then(t,e)};_i.prototype.catch=function(t){return this._getPromise().catch(t)};_i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};_i.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(u=>{e.emit("row",u,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Zf.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Zf.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var N_=h((OU,I_)=>{"use strict";var C_;try{C_=require("pg-native")}catch(t){throw t}var sj=dc(),A_=require("events").EventEmitter,oj=require("util"),cj=hf(),P_=T_(),pt=I_.exports=function(t){A_.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new sj(t.types),this.native=new C_({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new cj(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pt.Query=P_;oj.inherits(pt,A_);pt.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pt.prototype.query=function(t,e,r){let n,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,n=new P_(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return a&&(o=n.callback,s=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},a),n.callback=(u,c)=>{clearTimeout(s),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};pt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=a=>a?i(a):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};pt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pt.prototype.ref=function(){};pt.prototype.unref=function(){};pt.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Jf=h((qU,O_)=>{"use strict";O_.exports=N_()});var _c=h((RU,ps)=>{"use strict";var uj=x_(),lj=cs(),pj=Uf(),dj=gf(),fj=vi(),mj=__(),hj=dc(),{DatabaseError:vj}=Bf(),{escapeIdentifier:gj,escapeLiteral:yj}=vi(),xj=t=>class extends mj{constructor(r){super(r,t)}},Xf=function(t){this.defaults=lj,this.Client=t,this.Query=this.Client.Query,this.Pool=xj(this.Client),this._pools=[],this.Connection=pj,this.types=os(),this.DatabaseError=vj,this.TypeOverrides=hj,this.escapeIdentifier=gj,this.escapeLiteral=yj,this.Result=dj,this.utils=fj};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ps.exports=new Xf(Jf()):(ps.exports=new Xf(uj),Object.defineProperty(ps.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Xf(Jf())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ps.exports,"native",{value:t}),t}}))});var M_=h((hQ,D_)=>{"use strict";var wj=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},j_=()=>Math.ceil(Date.now()/1e3),R_=t=>t.replaceAll('"','""');D_.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#a;#s;#r;constructor(a={}){if(super(a),this.#a=a.schemaName?R_(a.schemaName):void 0,this.#r=a.tableName?R_(a.tableName):"session",!this.#a&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!a.createTableIfMissing,this.#s=void 0,this.ttl=a.ttl,this.#p=!!a.disableTouch,this.#o=a.errorLog||console.error.bind(console),a.pool!==void 0)this.#e=a.pool,this.#i=!1;else if(a.pgPromise!==void 0){if(typeof a.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=a.pgPromise,this.#i=!1}else{let s=a.conString||process.env.DATABASE_URL,o=a.conObject;o||(o={},s&&(o.connectionString=s)),this.#e=new(_c()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}a.pruneSessionInterval===!1?this.#t=!1:(this.#t=(a.pruneSessionInterval||900)*1e3,a.pruneSessionRandomizedInterval!==!1&&(this.#u=a.pruneSessionRandomizedInterval||(s=>Math.ceil(s/2+s*Math.random()))))}async _rawEnsureSessionStoreTable(){let a=this.quotedTable(),s=await this._asyncQuery("SELECT to_regclass($1::text)",[a],!0);if(s&&s.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',a);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(a){if(!(a||this.#l===!1))return this.#s||(this.#s=this._rawEnsureSessionStoreTable()),this.#s}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let a=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},a),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(a){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[j_()],s=>{if(a&&typeof a=="function")return a(s);s&&this.#o("Failed to prune sessions:",s),this.#d(),this.#n()})}quotedTable(){let a='"'+this.#r+'"';return this.#a&&(a='"'+this.#a+'".'+a),a}#f(a){let s;if(a&&a.cookie&&a.cookie.expires){let o=new Date(a.cookie.expires);s=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;s=Math.ceil(Date.now()/1e3+o)}return s}async _asyncQuery(a,s,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(a,s);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(a,s);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(a,s,o,u){let c;if(typeof s=="function"){if(o)throw new Error("Two callback functions set at once");o=s,c=[]}else c=s||[];let l=this._asyncQuery(a,c,u);wj(l,o)}get(a,s){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[a,j_()],(o,u)=>{if(o)return s(o);if(!u)return s(null);try{return s(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(a,s)}})}set(a,s,o){this.#n();let u=this.#f(s),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[s,u,a],l=>{o&&o(l)})}destroy(a,s){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[a],o=>{s&&s(o)})}touch(a,s,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(s);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,a],c=>{o&&o(c)})}}return n}});var z_=h((qQ,B_)=>{B_.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,a){n.push(["data",i,a])}),t.on("end",r=function(i,a){n.push(["end",i,a])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,a=n.length;i{function $_(){}$_.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};U_.exports=$_});var Tc=h((am,V_)=>{var H_=Q_();am=V_.exports=H_;am.Strategy=H_});var om=h((RQ,K_)=>{var _j=z_(),Ej=require("util"),G_=Tc();function sm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},G_.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}Ej.inherits(sm,G_);sm.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?_j(t):null;this._deserializeUser(n,t,function(a,s){if(a)return r.error(a);if(!s)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=s}r.pass(),i&&i.resume()})}else r.pass()};K_.exports=sm});var J_=h((DQ,Z_)=>{var W_=$n();function cm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}cm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,a=t.session;t.session.re
2026-01-15 16:57:51.02
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
2026-01-15 16:57:51.03
1e6c7d01
System
command finished with error [node ./dist/index.cjs]: exit status 1
2026-01-15 16:57:51.66
1e6c7d01
User
Seeding database...
2026-01-15 16:57:51.81
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
2026-01-15 16:57:51.81
1e6c7d01
User
`);ls.write(d_.format.apply(d_,e))}}Object.defineProperty(ar.exports,"isWin",{get:function(){return xc},set:function(t){xc=t}});ar.exports.warnTo=function(t){var e=ls;return ls=t,e};ar.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(xc?p_.join(e.APPDATA||"./","postgresql","pgpass.conf"):p_.join(e.HOME||"./",".pgpass"));return r};ar.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:xc?!0:(e=e||"",Qq(t.mode)?t.mode&(Bq|zq)?(Hf('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hf('WARNING: password file "%s" is not a plain file',e),!1))};var Vq=ar.exports.match=function(t,e){return wi.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||Lq)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ar.exports.getPassword=function(t,e,r){var n,i=e.pipe(Fq());function a(u){var c=Gq(u);c&&Kq(c)&&Vq(t,c)&&(n=c[Hq],i.end())}var s=function(){e.destroy(),r(n)},o=function(u){e.destroy(),Hf("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var Gq=ar.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,a=0,s={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[wi[l]]=f},c=0;c=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return s=Object.keys(s).length===Qf?s:null,s},Kq=ar.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},r=0;r{"use strict";var CU=require("path"),m_=require("fs"),bc=f_();Vf.exports=function(t,e){var r=bc.getFileName();m_.stat(r,function(n,i){if(n||!bc.usePgPass(i,r))return e(void 0);var a=m_.createReadStream(r);bc.getPassword(t,a,e)})};Vf.exports.warnTo=bc.warnTo});var x_=h((PU,y_)=>{"use strict";var Wq=require("events").EventEmitter,v_=vi(),Gf=DS(),Zq=dc(),Jq=hf(),g_=WS(),Xq=cs(),Yq=Uf(),ej=df(),wc=class extends Wq{constructor(e){super(),this.connectionParameters=new Jq(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zq(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new Yq({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xq.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{h_()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ej.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Gf.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Gf.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Gf.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return v_.escapeIdentifier(e)}escapeLiteral(e){return v_.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,a,s,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new g_(e,r,n),i.callback||(a=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),s&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};wc.Query=g_;y_.exports=wc});var __=h((IU,S_)=>{"use strict";var tj=require("events").EventEmitter,b_=function(){},w_=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Kf=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Si=class{constructor(e){this.callback=e}};function rj(){throw new Error("Release called on client which has already been released to the pool.")}function Sc(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(s,o){s?r(s):n(o)},a=new t(function(s,o){n=s,r=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function nj(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Wf=class extends tj{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||_c().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=w_(this._idle,a=>a.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=Sc(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Si(r.callback)),n;let i=(o,u,c)=>{clearTimeout(s),r.callback(o,u,c)},a=new Si(i),s=setTimeout(()=>{w_(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),n}return this.newClient(new Si(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=nj(this,r);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(s=>{if(i&&clearTimeout(i),r.on("error",n),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==r),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,b_);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Si((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,b_);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&rj(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Kf(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Sc(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let i=Sc(this.Promise,n);return n=i.callback,this.connect((a,s)=>{if(a)return n(a);let o=!1,u=c=>{o||(o=!0,s.release(c),n(c))};s.once("error",u),this.log("dispatching query");try{s.query(e,r,(c,l)=>{if(this.log("query dispatched"),s.removeListener("error",u),!o)return o=!0,s.release(c),c?n(c):n(void 0,l)})}catch(c){return s.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Sc(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};S_.exports=Wf});var T_=h((NU,k_)=>{"use strict";var E_=require("events").EventEmitter,ij=require("util"),Zf=vi(),_i=k_.exports=function(t,e,r){E_.call(this),t=Zf.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ij.inherits(_i,E_);var aj={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};_i.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=aj[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};_i.prototype.then=function(t,e){return this._getPromise().then(t,e)};_i.prototype.catch=function(t){return this._getPromise().catch(t)};_i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};_i.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(u=>{e.emit("row",u,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Zf.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Zf.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var N_=h((OU,I_)=>{"use strict";var C_;try{C_=require("pg-native")}catch(t){throw t}var sj=dc(),A_=require("events").EventEmitter,oj=require("util"),cj=hf(),P_=T_(),pt=I_.exports=function(t){A_.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new sj(t.types),this.native=new C_({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new cj(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pt.Query=P_;oj.inherits(pt,A_);pt.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pt.prototype.query=function(t,e,r){let n,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,n=new P_(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return a&&(o=n.callback,s=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},a),n.callback=(u,c)=>{clearTimeout(s),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};pt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=a=>a?i(a):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};pt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pt.prototype.ref=function(){};pt.prototype.unref=function(){};pt.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Jf=h((qU,O_)=>{"use strict";O_.exports=N_()});var _c=h((RU,ps)=>{"use strict";var uj=x_(),lj=cs(),pj=Uf(),dj=gf(),fj=vi(),mj=__(),hj=dc(),{DatabaseError:vj}=Bf(),{escapeIdentifier:gj,escapeLiteral:yj}=vi(),xj=t=>class extends mj{constructor(r){super(r,t)}},Xf=function(t){this.defaults=lj,this.Client=t,this.Query=this.Client.Query,this.Pool=xj(this.Client),this._pools=[],this.Connection=pj,this.types=os(),this.DatabaseError=vj,this.TypeOverrides=hj,this.escapeIdentifier=gj,this.escapeLiteral=yj,this.Result=dj,this.utils=fj};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ps.exports=new Xf(Jf()):(ps.exports=new Xf(uj),Object.defineProperty(ps.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Xf(Jf())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ps.exports,"native",{value:t}),t}}))});var M_=h((hQ,D_)=>{"use strict";var wj=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},j_=()=>Math.ceil(Date.now()/1e3),R_=t=>t.replaceAll('"','""');D_.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#a;#s;#r;constructor(a={}){if(super(a),this.#a=a.schemaName?R_(a.schemaName):void 0,this.#r=a.tableName?R_(a.tableName):"session",!this.#a&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!a.createTableIfMissing,this.#s=void 0,this.ttl=a.ttl,this.#p=!!a.disableTouch,this.#o=a.errorLog||console.error.bind(console),a.pool!==void 0)this.#e=a.pool,this.#i=!1;else if(a.pgPromise!==void 0){if(typeof a.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=a.pgPromise,this.#i=!1}else{let s=a.conString||process.env.DATABASE_URL,o=a.conObject;o||(o={},s&&(o.connectionString=s)),this.#e=new(_c()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}a.pruneSessionInterval===!1?this.#t=!1:(this.#t=(a.pruneSessionInterval||900)*1e3,a.pruneSessionRandomizedInterval!==!1&&(this.#u=a.pruneSessionRandomizedInterval||(s=>Math.ceil(s/2+s*Math.random()))))}async _rawEnsureSessionStoreTable(){let a=this.quotedTable(),s=await this._asyncQuery("SELECT to_regclass($1::text)",[a],!0);if(s&&s.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',a);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(a){if(!(a||this.#l===!1))return this.#s||(this.#s=this._rawEnsureSessionStoreTable()),this.#s}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let a=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},a),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(a){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[j_()],s=>{if(a&&typeof a=="function")return a(s);s&&this.#o("Failed to prune sessions:",s),this.#d(),this.#n()})}quotedTable(){let a='"'+this.#r+'"';return this.#a&&(a='"'+this.#a+'".'+a),a}#f(a){let s;if(a&&a.cookie&&a.cookie.expires){let o=new Date(a.cookie.expires);s=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;s=Math.ceil(Date.now()/1e3+o)}return s}async _asyncQuery(a,s,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(a,s);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(a,s);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(a,s,o,u){let c;if(typeof s=="function"){if(o)throw new Error("Two callback functions set at once");o=s,c=[]}else c=s||[];let l=this._asyncQuery(a,c,u);wj(l,o)}get(a,s){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[a,j_()],(o,u)=>{if(o)return s(o);if(!u)return s(null);try{return s(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(a,s)}})}set(a,s,o){this.#n();let u=this.#f(s),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[s,u,a],l=>{o&&o(l)})}destroy(a,s){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[a],o=>{s&&s(o)})}touch(a,s,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(s);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,a],c=>{o&&o(c)})}}return n}});var z_=h((qQ,B_)=>{B_.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,a){n.push(["data",i,a])}),t.on("end",r=function(i,a){n.push(["end",i,a])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,a=n.length;i{function $_(){}$_.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};U_.exports=$_});var Tc=h((am,V_)=>{var H_=Q_();am=V_.exports=H_;am.Strategy=H_});var om=h((RQ,K_)=>{var _j=z_(),Ej=require("util"),G_=Tc();function sm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},G_.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}Ej.inherits(sm,G_);sm.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?_j(t):null;this._deserializeUser(n,t,function(a,s){if(a)return r.error(a);if(!s)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=s}r.pass(),i&&i.resume()})}else r.pass()};K_.exports=sm});var J_=h((DQ,Z_)=>{var W_=$n();function cm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}cm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,a=t.session;t.session.re
2026-01-15 16:57:51.81
1e6c7d01
User
/home/runner/workspace/dist/index.cjs:70
2026-01-15 16:57:51.82
1e6c7d01
System
command finished with error [node ./dist/index.cjs]: exit status 1
2026-01-15 16:57:52.75
1e6c7d01
User
Seeding database...
2026-01-15 16:57:52.89
1e6c7d01
User
`);ls.write(d_.format.apply(d_,e))}}Object.defineProperty(ar.exports,"isWin",{get:function(){return xc},set:function(t){xc=t}});ar.exports.warnTo=function(t){var e=ls;return ls=t,e};ar.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(xc?p_.join(e.APPDATA||"./","postgresql","pgpass.conf"):p_.join(e.HOME||"./",".pgpass"));return r};ar.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:xc?!0:(e=e||"",Qq(t.mode)?t.mode&(Bq|zq)?(Hf('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hf('WARNING: password file "%s" is not a plain file',e),!1))};var Vq=ar.exports.match=function(t,e){return wi.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||Lq)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ar.exports.getPassword=function(t,e,r){var n,i=e.pipe(Fq());function a(u){var c=Gq(u);c&&Kq(c)&&Vq(t,c)&&(n=c[Hq],i.end())}var s=function(){e.destroy(),r(n)},o=function(u){e.destroy(),Hf("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var Gq=ar.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,a=0,s={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[wi[l]]=f},c=0;c=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return s=Object.keys(s).length===Qf?s:null,s},Kq=ar.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},r=0;r{"use strict";var CU=require("path"),m_=require("fs"),bc=f_();Vf.exports=function(t,e){var r=bc.getFileName();m_.stat(r,function(n,i){if(n||!bc.usePgPass(i,r))return e(void 0);var a=m_.createReadStream(r);bc.getPassword(t,a,e)})};Vf.exports.warnTo=bc.warnTo});var x_=h((PU,y_)=>{"use strict";var Wq=require("events").EventEmitter,v_=vi(),Gf=DS(),Zq=dc(),Jq=hf(),g_=WS(),Xq=cs(),Yq=Uf(),ej=df(),wc=class extends Wq{constructor(e){super(),this.connectionParameters=new Jq(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zq(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new Yq({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xq.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{h_()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ej.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Gf.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Gf.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Gf.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return v_.escapeIdentifier(e)}escapeLiteral(e){return v_.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,a,s,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new g_(e,r,n),i.callback||(a=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),s&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};wc.Query=g_;y_.exports=wc});var __=h((IU,S_)=>{"use strict";var tj=require("events").EventEmitter,b_=function(){},w_=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Kf=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Si=class{constructor(e){this.callback=e}};function rj(){throw new Error("Release called on client which has already been released to the pool.")}function Sc(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(s,o){s?r(s):n(o)},a=new t(function(s,o){n=s,r=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function nj(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Wf=class extends tj{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||_c().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=w_(this._idle,a=>a.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=Sc(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Si(r.callback)),n;let i=(o,u,c)=>{clearTimeout(s),r.callback(o,u,c)},a=new Si(i),s=setTimeout(()=>{w_(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),n}return this.newClient(new Si(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=nj(this,r);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(s=>{if(i&&clearTimeout(i),r.on("error",n),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==r),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,b_);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Si((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,b_);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&rj(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Kf(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Sc(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let i=Sc(this.Promise,n);return n=i.callback,this.connect((a,s)=>{if(a)return n(a);let o=!1,u=c=>{o||(o=!0,s.release(c),n(c))};s.once("error",u),this.log("dispatching query");try{s.query(e,r,(c,l)=>{if(this.log("query dispatched"),s.removeListener("error",u),!o)return o=!0,s.release(c),c?n(c):n(void 0,l)})}catch(c){return s.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Sc(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};S_.exports=Wf});var T_=h((NU,k_)=>{"use strict";var E_=require("events").EventEmitter,ij=require("util"),Zf=vi(),_i=k_.exports=function(t,e,r){E_.call(this),t=Zf.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ij.inherits(_i,E_);var aj={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};_i.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=aj[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};_i.prototype.then=function(t,e){return this._getPromise().then(t,e)};_i.prototype.catch=function(t){return this._getPromise().catch(t)};_i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};_i.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(u=>{e.emit("row",u,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Zf.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Zf.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var N_=h((OU,I_)=>{"use strict";var C_;try{C_=require("pg-native")}catch(t){throw t}var sj=dc(),A_=require("events").EventEmitter,oj=require("util"),cj=hf(),P_=T_(),pt=I_.exports=function(t){A_.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new sj(t.types),this.native=new C_({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new cj(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pt.Query=P_;oj.inherits(pt,A_);pt.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pt.prototype.query=function(t,e,r){let n,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,n=new P_(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return a&&(o=n.callback,s=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},a),n.callback=(u,c)=>{clearTimeout(s),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};pt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=a=>a?i(a):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};pt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pt.prototype.ref=function(){};pt.prototype.unref=function(){};pt.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Jf=h((qU,O_)=>{"use strict";O_.exports=N_()});var _c=h((RU,ps)=>{"use strict";var uj=x_(),lj=cs(),pj=Uf(),dj=gf(),fj=vi(),mj=__(),hj=dc(),{DatabaseError:vj}=Bf(),{escapeIdentifier:gj,escapeLiteral:yj}=vi(),xj=t=>class extends mj{constructor(r){super(r,t)}},Xf=function(t){this.defaults=lj,this.Client=t,this.Query=this.Client.Query,this.Pool=xj(this.Client),this._pools=[],this.Connection=pj,this.types=os(),this.DatabaseError=vj,this.TypeOverrides=hj,this.escapeIdentifier=gj,this.escapeLiteral=yj,this.Result=dj,this.utils=fj};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ps.exports=new Xf(Jf()):(ps.exports=new Xf(uj),Object.defineProperty(ps.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Xf(Jf())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ps.exports,"native",{value:t}),t}}))});var M_=h((hQ,D_)=>{"use strict";var wj=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},j_=()=>Math.ceil(Date.now()/1e3),R_=t=>t.replaceAll('"','""');D_.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#a;#s;#r;constructor(a={}){if(super(a),this.#a=a.schemaName?R_(a.schemaName):void 0,this.#r=a.tableName?R_(a.tableName):"session",!this.#a&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!a.createTableIfMissing,this.#s=void 0,this.ttl=a.ttl,this.#p=!!a.disableTouch,this.#o=a.errorLog||console.error.bind(console),a.pool!==void 0)this.#e=a.pool,this.#i=!1;else if(a.pgPromise!==void 0){if(typeof a.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=a.pgPromise,this.#i=!1}else{let s=a.conString||process.env.DATABASE_URL,o=a.conObject;o||(o={},s&&(o.connectionString=s)),this.#e=new(_c()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}a.pruneSessionInterval===!1?this.#t=!1:(this.#t=(a.pruneSessionInterval||900)*1e3,a.pruneSessionRandomizedInterval!==!1&&(this.#u=a.pruneSessionRandomizedInterval||(s=>Math.ceil(s/2+s*Math.random()))))}async _rawEnsureSessionStoreTable(){let a=this.quotedTable(),s=await this._asyncQuery("SELECT to_regclass($1::text)",[a],!0);if(s&&s.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',a);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(a){if(!(a||this.#l===!1))return this.#s||(this.#s=this._rawEnsureSessionStoreTable()),this.#s}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let a=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},a),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(a){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[j_()],s=>{if(a&&typeof a=="function")return a(s);s&&this.#o("Failed to prune sessions:",s),this.#d(),this.#n()})}quotedTable(){let a='"'+this.#r+'"';return this.#a&&(a='"'+this.#a+'".'+a),a}#f(a){let s;if(a&&a.cookie&&a.cookie.expires){let o=new Date(a.cookie.expires);s=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;s=Math.ceil(Date.now()/1e3+o)}return s}async _asyncQuery(a,s,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(a,s);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(a,s);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(a,s,o,u){let c;if(typeof s=="function"){if(o)throw new Error("Two callback functions set at once");o=s,c=[]}else c=s||[];let l=this._asyncQuery(a,c,u);wj(l,o)}get(a,s){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[a,j_()],(o,u)=>{if(o)return s(o);if(!u)return s(null);try{return s(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(a,s)}})}set(a,s,o){this.#n();let u=this.#f(s),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[s,u,a],l=>{o&&o(l)})}destroy(a,s){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[a],o=>{s&&s(o)})}touch(a,s,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(s);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,a],c=>{o&&o(c)})}}return n}});var z_=h((qQ,B_)=>{B_.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,a){n.push(["data",i,a])}),t.on("end",r=function(i,a){n.push(["end",i,a])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,a=n.length;i{function $_(){}$_.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};U_.exports=$_});var Tc=h((am,V_)=>{var H_=Q_();am=V_.exports=H_;am.Strategy=H_});var om=h((RQ,K_)=>{var _j=z_(),Ej=require("util"),G_=Tc();function sm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},G_.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}Ej.inherits(sm,G_);sm.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?_j(t):null;this._deserializeUser(n,t,function(a,s){if(a)return r.error(a);if(!s)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=s}r.pass(),i&&i.resume()})}else r.pass()};K_.exports=sm});var J_=h((DQ,Z_)=>{var W_=$n();function cm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}cm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,a=t.session;t.session.re
2026-01-15 16:57:52.89
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
2026-01-15 16:57:52.89
1e6c7d01
User
/home/runner/workspace/dist/index.cjs:70
2026-01-15 16:57:52.90
1e6c7d01
System
command finished with error [node ./dist/index.cjs]: exit status 1
2026-01-15 16:57:53.94
1e6c7d01
User
Seeding database...
2026-01-15 16:57:54.08
1e6c7d01
User
`);ls.write(d_.format.apply(d_,e))}}Object.defineProperty(ar.exports,"isWin",{get:function(){return xc},set:function(t){xc=t}});ar.exports.warnTo=function(t){var e=ls;return ls=t,e};ar.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(xc?p_.join(e.APPDATA||"./","postgresql","pgpass.conf"):p_.join(e.HOME||"./",".pgpass"));return r};ar.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:xc?!0:(e=e||"",Qq(t.mode)?t.mode&(Bq|zq)?(Hf('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hf('WARNING: password file "%s" is not a plain file',e),!1))};var Vq=ar.exports.match=function(t,e){return wi.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||Lq)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ar.exports.getPassword=function(t,e,r){var n,i=e.pipe(Fq());function a(u){var c=Gq(u);c&&Kq(c)&&Vq(t,c)&&(n=c[Hq],i.end())}var s=function(){e.destroy(),r(n)},o=function(u){e.destroy(),Hf("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var Gq=ar.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,a=0,s={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[wi[l]]=f},c=0;c=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return s=Object.keys(s).length===Qf?s:null,s},Kq=ar.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},r=0;r{"use strict";var CU=require("path"),m_=require("fs"),bc=f_();Vf.exports=function(t,e){var r=bc.getFileName();m_.stat(r,function(n,i){if(n||!bc.usePgPass(i,r))return e(void 0);var a=m_.createReadStream(r);bc.getPassword(t,a,e)})};Vf.exports.warnTo=bc.warnTo});var x_=h((PU,y_)=>{"use strict";var Wq=require("events").EventEmitter,v_=vi(),Gf=DS(),Zq=dc(),Jq=hf(),g_=WS(),Xq=cs(),Yq=Uf(),ej=df(),wc=class extends Wq{constructor(e){super(),this.connectionParameters=new Jq(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zq(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new Yq({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xq.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{h_()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ej.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Gf.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Gf.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Gf.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return v_.escapeIdentifier(e)}escapeLiteral(e){return v_.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,a,s,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new g_(e,r,n),i.callback||(a=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),s&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};wc.Query=g_;y_.exports=wc});var __=h((IU,S_)=>{"use strict";var tj=require("events").EventEmitter,b_=function(){},w_=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Kf=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Si=class{constructor(e){this.callback=e}};function rj(){throw new Error("Release called on client which has already been released to the pool.")}function Sc(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(s,o){s?r(s):n(o)},a=new t(function(s,o){n=s,r=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function nj(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Wf=class extends tj{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||_c().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=w_(this._idle,a=>a.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=Sc(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Si(r.callback)),n;let i=(o,u,c)=>{clearTimeout(s),r.callback(o,u,c)},a=new Si(i),s=setTimeout(()=>{w_(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),n}return this.newClient(new Si(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=nj(this,r);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(s=>{if(i&&clearTimeout(i),r.on("error",n),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==r),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,b_);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Si((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,b_);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&rj(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Kf(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Sc(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let i=Sc(this.Promise,n);return n=i.callback,this.connect((a,s)=>{if(a)return n(a);let o=!1,u=c=>{o||(o=!0,s.release(c),n(c))};s.once("error",u),this.log("dispatching query");try{s.query(e,r,(c,l)=>{if(this.log("query dispatched"),s.removeListener("error",u),!o)return o=!0,s.release(c),c?n(c):n(void 0,l)})}catch(c){return s.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Sc(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};S_.exports=Wf});var T_=h((NU,k_)=>{"use strict";var E_=require("events").EventEmitter,ij=require("util"),Zf=vi(),_i=k_.exports=function(t,e,r){E_.call(this),t=Zf.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ij.inherits(_i,E_);var aj={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};_i.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=aj[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};_i.prototype.then=function(t,e){return this._getPromise().then(t,e)};_i.prototype.catch=function(t){return this._getPromise().catch(t)};_i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};_i.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(u=>{e.emit("row",u,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Zf.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Zf.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var N_=h((OU,I_)=>{"use strict";var C_;try{C_=require("pg-native")}catch(t){throw t}var sj=dc(),A_=require("events").EventEmitter,oj=require("util"),cj=hf(),P_=T_(),pt=I_.exports=function(t){A_.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new sj(t.types),this.native=new C_({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new cj(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pt.Query=P_;oj.inherits(pt,A_);pt.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pt.prototype.query=function(t,e,r){let n,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,n=new P_(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return a&&(o=n.callback,s=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},a),n.callback=(u,c)=>{clearTimeout(s),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};pt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=a=>a?i(a):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};pt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pt.prototype.ref=function(){};pt.prototype.unref=function(){};pt.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Jf=h((qU,O_)=>{"use strict";O_.exports=N_()});var _c=h((RU,ps)=>{"use strict";var uj=x_(),lj=cs(),pj=Uf(),dj=gf(),fj=vi(),mj=__(),hj=dc(),{DatabaseError:vj}=Bf(),{escapeIdentifier:gj,escapeLiteral:yj}=vi(),xj=t=>class extends mj{constructor(r){super(r,t)}},Xf=function(t){this.defaults=lj,this.Client=t,this.Query=this.Client.Query,this.Pool=xj(this.Client),this._pools=[],this.Connection=pj,this.types=os(),this.DatabaseError=vj,this.TypeOverrides=hj,this.escapeIdentifier=gj,this.escapeLiteral=yj,this.Result=dj,this.utils=fj};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ps.exports=new Xf(Jf()):(ps.exports=new Xf(uj),Object.defineProperty(ps.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Xf(Jf())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ps.exports,"native",{value:t}),t}}))});var M_=h((hQ,D_)=>{"use strict";var wj=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},j_=()=>Math.ceil(Date.now()/1e3),R_=t=>t.replaceAll('"','""');D_.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#a;#s;#r;constructor(a={}){if(super(a),this.#a=a.schemaName?R_(a.schemaName):void 0,this.#r=a.tableName?R_(a.tableName):"session",!this.#a&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!a.createTableIfMissing,this.#s=void 0,this.ttl=a.ttl,this.#p=!!a.disableTouch,this.#o=a.errorLog||console.error.bind(console),a.pool!==void 0)this.#e=a.pool,this.#i=!1;else if(a.pgPromise!==void 0){if(typeof a.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=a.pgPromise,this.#i=!1}else{let s=a.conString||process.env.DATABASE_URL,o=a.conObject;o||(o={},s&&(o.connectionString=s)),this.#e=new(_c()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}a.pruneSessionInterval===!1?this.#t=!1:(this.#t=(a.pruneSessionInterval||900)*1e3,a.pruneSessionRandomizedInterval!==!1&&(this.#u=a.pruneSessionRandomizedInterval||(s=>Math.ceil(s/2+s*Math.random()))))}async _rawEnsureSessionStoreTable(){let a=this.quotedTable(),s=await this._asyncQuery("SELECT to_regclass($1::text)",[a],!0);if(s&&s.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',a);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(a){if(!(a||this.#l===!1))return this.#s||(this.#s=this._rawEnsureSessionStoreTable()),this.#s}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let a=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},a),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(a){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[j_()],s=>{if(a&&typeof a=="function")return a(s);s&&this.#o("Failed to prune sessions:",s),this.#d(),this.#n()})}quotedTable(){let a='"'+this.#r+'"';return this.#a&&(a='"'+this.#a+'".'+a),a}#f(a){let s;if(a&&a.cookie&&a.cookie.expires){let o=new Date(a.cookie.expires);s=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;s=Math.ceil(Date.now()/1e3+o)}return s}async _asyncQuery(a,s,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(a,s);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(a,s);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(a,s,o,u){let c;if(typeof s=="function"){if(o)throw new Error("Two callback functions set at once");o=s,c=[]}else c=s||[];let l=this._asyncQuery(a,c,u);wj(l,o)}get(a,s){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[a,j_()],(o,u)=>{if(o)return s(o);if(!u)return s(null);try{return s(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(a,s)}})}set(a,s,o){this.#n();let u=this.#f(s),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[s,u,a],l=>{o&&o(l)})}destroy(a,s){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[a],o=>{s&&s(o)})}touch(a,s,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(s);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,a],c=>{o&&o(c)})}}return n}});var z_=h((qQ,B_)=>{B_.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,a){n.push(["data",i,a])}),t.on("end",r=function(i,a){n.push(["end",i,a])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,a=n.length;i{function $_(){}$_.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};U_.exports=$_});var Tc=h((am,V_)=>{var H_=Q_();am=V_.exports=H_;am.Strategy=H_});var om=h((RQ,K_)=>{var _j=z_(),Ej=require("util"),G_=Tc();function sm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},G_.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}Ej.inherits(sm,G_);sm.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?_j(t):null;this._deserializeUser(n,t,function(a,s){if(a)return r.error(a);if(!s)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=s}r.pass(),i&&i.resume()})}else r.pass()};K_.exports=sm});var J_=h((DQ,Z_)=>{var W_=$n();function cm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}cm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,a=t.session;t.session.re
2026-01-15 16:57:54.08
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
2026-01-15 16:57:54.08
1e6c7d01
User
/home/runner/workspace/dist/index.cjs:70
2026-01-15 16:57:54.08
1e6c7d01
System
command finished with error [node ./dist/index.cjs]: exit status 1
2026-01-15 16:57:55.34
1e6c7d01
User
Seeding database...
2026-01-15 16:57:55.47
1e6c7d01
User
`);ls.write(d_.format.apply(d_,e))}}Object.defineProperty(ar.exports,"isWin",{get:function(){return xc},set:function(t){xc=t}});ar.exports.warnTo=function(t){var e=ls;return ls=t,e};ar.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(xc?p_.join(e.APPDATA||"./","postgresql","pgpass.conf"):p_.join(e.HOME||"./",".pgpass"));return r};ar.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:xc?!0:(e=e||"",Qq(t.mode)?t.mode&(Bq|zq)?(Hf('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hf('WARNING: password file "%s" is not a plain file',e),!1))};var Vq=ar.exports.match=function(t,e){return wi.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||Lq)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ar.exports.getPassword=function(t,e,r){var n,i=e.pipe(Fq());function a(u){var c=Gq(u);c&&Kq(c)&&Vq(t,c)&&(n=c[Hq],i.end())}var s=function(){e.destroy(),r(n)},o=function(u){e.destroy(),Hf("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var Gq=ar.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,a=0,s={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[wi[l]]=f},c=0;c=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return s=Object.keys(s).length===Qf?s:null,s},Kq=ar.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},r=0;r{"use strict";var CU=require("path"),m_=require("fs"),bc=f_();Vf.exports=function(t,e){var r=bc.getFileName();m_.stat(r,function(n,i){if(n||!bc.usePgPass(i,r))return e(void 0);var a=m_.createReadStream(r);bc.getPassword(t,a,e)})};Vf.exports.warnTo=bc.warnTo});var x_=h((PU,y_)=>{"use strict";var Wq=require("events").EventEmitter,v_=vi(),Gf=DS(),Zq=dc(),Jq=hf(),g_=WS(),Xq=cs(),Yq=Uf(),ej=df(),wc=class extends Wq{constructor(e){super(),this.connectionParameters=new Jq(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zq(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new Yq({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xq.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{h_()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ej.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Gf.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Gf.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Gf.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return v_.escapeIdentifier(e)}escapeLiteral(e){return v_.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,a,s,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new g_(e,r,n),i.callback||(a=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),s&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};wc.Query=g_;y_.exports=wc});var __=h((IU,S_)=>{"use strict";var tj=require("events").EventEmitter,b_=function(){},w_=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Kf=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Si=class{constructor(e){this.callback=e}};function rj(){throw new Error("Release called on client which has already been released to the pool.")}function Sc(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(s,o){s?r(s):n(o)},a=new t(function(s,o){n=s,r=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function nj(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Wf=class extends tj{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||_c().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=w_(this._idle,a=>a.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=Sc(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Si(r.callback)),n;let i=(o,u,c)=>{clearTimeout(s),r.callback(o,u,c)},a=new Si(i),s=setTimeout(()=>{w_(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),n}return this.newClient(new Si(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=nj(this,r);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(s=>{if(i&&clearTimeout(i),r.on("error",n),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==r),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,b_);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Si((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,b_);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&rj(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Kf(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Sc(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let i=Sc(this.Promise,n);return n=i.callback,this.connect((a,s)=>{if(a)return n(a);let o=!1,u=c=>{o||(o=!0,s.release(c),n(c))};s.once("error",u),this.log("dispatching query");try{s.query(e,r,(c,l)=>{if(this.log("query dispatched"),s.removeListener("error",u),!o)return o=!0,s.release(c),c?n(c):n(void 0,l)})}catch(c){return s.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Sc(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};S_.exports=Wf});var T_=h((NU,k_)=>{"use strict";var E_=require("events").EventEmitter,ij=require("util"),Zf=vi(),_i=k_.exports=function(t,e,r){E_.call(this),t=Zf.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ij.inherits(_i,E_);var aj={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};_i.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=aj[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};_i.prototype.then=function(t,e){return this._getPromise().then(t,e)};_i.prototype.catch=function(t){return this._getPromise().catch(t)};_i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};_i.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(u=>{e.emit("row",u,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Zf.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Zf.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var N_=h((OU,I_)=>{"use strict";var C_;try{C_=require("pg-native")}catch(t){throw t}var sj=dc(),A_=require("events").EventEmitter,oj=require("util"),cj=hf(),P_=T_(),pt=I_.exports=function(t){A_.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new sj(t.types),this.native=new C_({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new cj(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pt.Query=P_;oj.inherits(pt,A_);pt.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pt.prototype.query=function(t,e,r){let n,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,n=new P_(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return a&&(o=n.callback,s=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},a),n.callback=(u,c)=>{clearTimeout(s),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};pt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=a=>a?i(a):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};pt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pt.prototype.ref=function(){};pt.prototype.unref=function(){};pt.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Jf=h((qU,O_)=>{"use strict";O_.exports=N_()});var _c=h((RU,ps)=>{"use strict";var uj=x_(),lj=cs(),pj=Uf(),dj=gf(),fj=vi(),mj=__(),hj=dc(),{DatabaseError:vj}=Bf(),{escapeIdentifier:gj,escapeLiteral:yj}=vi(),xj=t=>class extends mj{constructor(r){super(r,t)}},Xf=function(t){this.defaults=lj,this.Client=t,this.Query=this.Client.Query,this.Pool=xj(this.Client),this._pools=[],this.Connection=pj,this.types=os(),this.DatabaseError=vj,this.TypeOverrides=hj,this.escapeIdentifier=gj,this.escapeLiteral=yj,this.Result=dj,this.utils=fj};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ps.exports=new Xf(Jf()):(ps.exports=new Xf(uj),Object.defineProperty(ps.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Xf(Jf())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ps.exports,"native",{value:t}),t}}))});var M_=h((hQ,D_)=>{"use strict";var wj=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},j_=()=>Math.ceil(Date.now()/1e3),R_=t=>t.replaceAll('"','""');D_.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#a;#s;#r;constructor(a={}){if(super(a),this.#a=a.schemaName?R_(a.schemaName):void 0,this.#r=a.tableName?R_(a.tableName):"session",!this.#a&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!a.createTableIfMissing,this.#s=void 0,this.ttl=a.ttl,this.#p=!!a.disableTouch,this.#o=a.errorLog||console.error.bind(console),a.pool!==void 0)this.#e=a.pool,this.#i=!1;else if(a.pgPromise!==void 0){if(typeof a.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=a.pgPromise,this.#i=!1}else{let s=a.conString||process.env.DATABASE_URL,o=a.conObject;o||(o={},s&&(o.connectionString=s)),this.#e=new(_c()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}a.pruneSessionInterval===!1?this.#t=!1:(this.#t=(a.pruneSessionInterval||900)*1e3,a.pruneSessionRandomizedInterval!==!1&&(this.#u=a.pruneSessionRandomizedInterval||(s=>Math.ceil(s/2+s*Math.random()))))}async _rawEnsureSessionStoreTable(){let a=this.quotedTable(),s=await this._asyncQuery("SELECT to_regclass($1::text)",[a],!0);if(s&&s.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',a);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(a){if(!(a||this.#l===!1))return this.#s||(this.#s=this._rawEnsureSessionStoreTable()),this.#s}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let a=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},a),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(a){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[j_()],s=>{if(a&&typeof a=="function")return a(s);s&&this.#o("Failed to prune sessions:",s),this.#d(),this.#n()})}quotedTable(){let a='"'+this.#r+'"';return this.#a&&(a='"'+this.#a+'".'+a),a}#f(a){let s;if(a&&a.cookie&&a.cookie.expires){let o=new Date(a.cookie.expires);s=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;s=Math.ceil(Date.now()/1e3+o)}return s}async _asyncQuery(a,s,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(a,s);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(a,s);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(a,s,o,u){let c;if(typeof s=="function"){if(o)throw new Error("Two callback functions set at once");o=s,c=[]}else c=s||[];let l=this._asyncQuery(a,c,u);wj(l,o)}get(a,s){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[a,j_()],(o,u)=>{if(o)return s(o);if(!u)return s(null);try{return s(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(a,s)}})}set(a,s,o){this.#n();let u=this.#f(s),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[s,u,a],l=>{o&&o(l)})}destroy(a,s){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[a],o=>{s&&s(o)})}touch(a,s,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(s);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,a],c=>{o&&o(c)})}}return n}});var z_=h((qQ,B_)=>{B_.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,a){n.push(["data",i,a])}),t.on("end",r=function(i,a){n.push(["end",i,a])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,a=n.length;i{function $_(){}$_.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};U_.exports=$_});var Tc=h((am,V_)=>{var H_=Q_();am=V_.exports=H_;am.Strategy=H_});var om=h((RQ,K_)=>{var _j=z_(),Ej=require("util"),G_=Tc();function sm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},G_.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}Ej.inherits(sm,G_);sm.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?_j(t):null;this._deserializeUser(n,t,function(a,s){if(a)return r.error(a);if(!s)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=s}r.pass(),i&&i.resume()})}else r.pass()};K_.exports=sm});var J_=h((DQ,Z_)=>{var W_=$n();function cm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}cm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,a=t.session;t.session.re
2026-01-15 16:57:55.47
1e6c7d01
User
/home/runner/workspace/dist/index.cjs:70
2026-01-15 16:57:55.47
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
2026-01-15 16:57:55.48
1e6c7d01
System
command finished with error [node ./dist/index.cjs]: exit status 1
2026-01-15 16:57:56.86
1e6c7d01
User
Seeding database...
2026-01-15 16:57:56.99
1e6c7d01
User
`);ls.write(d_.format.apply(d_,e))}}Object.defineProperty(ar.exports,"isWin",{get:function(){return xc},set:function(t){xc=t}});ar.exports.warnTo=function(t){var e=ls;return ls=t,e};ar.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(xc?p_.join(e.APPDATA||"./","postgresql","pgpass.conf"):p_.join(e.HOME||"./",".pgpass"));return r};ar.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:xc?!0:(e=e||"",Qq(t.mode)?t.mode&(Bq|zq)?(Hf('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hf('WARNING: password file "%s" is not a plain file',e),!1))};var Vq=ar.exports.match=function(t,e){return wi.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||Lq)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ar.exports.getPassword=function(t,e,r){var n,i=e.pipe(Fq());function a(u){var c=Gq(u);c&&Kq(c)&&Vq(t,c)&&(n=c[Hq],i.end())}var s=function(){e.destroy(),r(n)},o=function(u){e.destroy(),Hf("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var Gq=ar.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,a=0,s={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[wi[l]]=f},c=0;c=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return s=Object.keys(s).length===Qf?s:null,s},Kq=ar.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},r=0;r{"use strict";var CU=require("path"),m_=require("fs"),bc=f_();Vf.exports=function(t,e){var r=bc.getFileName();m_.stat(r,function(n,i){if(n||!bc.usePgPass(i,r))return e(void 0);var a=m_.createReadStream(r);bc.getPassword(t,a,e)})};Vf.exports.warnTo=bc.warnTo});var x_=h((PU,y_)=>{"use strict";var Wq=require("events").EventEmitter,v_=vi(),Gf=DS(),Zq=dc(),Jq=hf(),g_=WS(),Xq=cs(),Yq=Uf(),ej=df(),wc=class extends Wq{constructor(e){super(),this.connectionParameters=new Jq(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Zq(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new Yq({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Xq.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{h_()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ej.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Gf.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Gf.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Gf.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return v_.escapeIdentifier(e)}escapeLiteral(e){return v_.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,a,s,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new g_(e,r,n),i.callback||(a=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),s&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};wc.Query=g_;y_.exports=wc});var __=h((IU,S_)=>{"use strict";var tj=require("events").EventEmitter,b_=function(){},w_=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Kf=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Si=class{constructor(e){this.callback=e}};function rj(){throw new Error("Release called on client which has already been released to the pool.")}function Sc(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(s,o){s?r(s):n(o)},a=new t(function(s,o){n=s,r=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function nj(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Wf=class extends tj{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||_c().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=w_(this._idle,a=>a.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=Sc(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Si(r.callback)),n;let i=(o,u,c)=>{clearTimeout(s),r.callback(o,u,c)},a=new Si(i),s=setTimeout(()=>{w_(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),n}return this.newClient(new Si(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=nj(this,r);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(s=>{if(i&&clearTimeout(i),r.on("error",n),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==r),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,b_);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Si((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,b_);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&rj(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Kf(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Sc(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let i=Sc(this.Promise,n);return n=i.callback,this.connect((a,s)=>{if(a)return n(a);let o=!1,u=c=>{o||(o=!0,s.release(c),n(c))};s.once("error",u),this.log("dispatching query");try{s.query(e,r,(c,l)=>{if(this.log("query dispatched"),s.removeListener("error",u),!o)return o=!0,s.release(c),c?n(c):n(void 0,l)})}catch(c){return s.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Sc(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};S_.exports=Wf});var T_=h((NU,k_)=>{"use strict";var E_=require("events").EventEmitter,ij=require("util"),Zf=vi(),_i=k_.exports=function(t,e,r){E_.call(this),t=Zf.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};ij.inherits(_i,E_);var aj={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};_i.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=aj[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};_i.prototype.then=function(t,e){return this._getPromise().then(t,e)};_i.prototype.catch=function(t){return this._getPromise().catch(t)};_i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};_i.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(u=>{e.emit("row",u,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Zf.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Zf.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var N_=h((OU,I_)=>{"use strict";var C_;try{C_=require("pg-native")}catch(t){throw t}var sj=dc(),A_=require("events").EventEmitter,oj=require("util"),cj=hf(),P_=T_(),pt=I_.exports=function(t){A_.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new sj(t.types),this.native=new C_({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new cj(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pt.Query=P_;oj.inherits(pt,A_);pt.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pt.prototype.query=function(t,e,r){let n,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,n=new P_(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return a&&(o=n.callback,s=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},a),n.callback=(u,c)=>{clearTimeout(s),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};pt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=a=>a?i(a):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};pt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pt.prototype.ref=function(){};pt.prototype.unref=function(){};pt.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Jf=h((qU,O_)=>{"use strict";O_.exports=N_()});var _c=h((RU,ps)=>{"use strict";var uj=x_(),lj=cs(),pj=Uf(),dj=gf(),fj=vi(),mj=__(),hj=dc(),{DatabaseError:vj}=Bf(),{escapeIdentifier:gj,escapeLiteral:yj}=vi(),xj=t=>class extends mj{constructor(r){super(r,t)}},Xf=function(t){this.defaults=lj,this.Client=t,this.Query=this.Client.Query,this.Pool=xj(this.Client),this._pools=[],this.Connection=pj,this.types=os(),this.DatabaseError=vj,this.TypeOverrides=hj,this.escapeIdentifier=gj,this.escapeLiteral=yj,this.Result=dj,this.utils=fj};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ps.exports=new Xf(Jf()):(ps.exports=new Xf(uj),Object.defineProperty(ps.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Xf(Jf())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ps.exports,"native",{value:t}),t}}))});var M_=h((hQ,D_)=>{"use strict";var wj=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},j_=()=>Math.ceil(Date.now()/1e3),R_=t=>t.replaceAll('"','""');D_.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#a;#s;#r;constructor(a={}){if(super(a),this.#a=a.schemaName?R_(a.schemaName):void 0,this.#r=a.tableName?R_(a.tableName):"session",!this.#a&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!a.createTableIfMissing,this.#s=void 0,this.ttl=a.ttl,this.#p=!!a.disableTouch,this.#o=a.errorLog||console.error.bind(console),a.pool!==void 0)this.#e=a.pool,this.#i=!1;else if(a.pgPromise!==void 0){if(typeof a.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=a.pgPromise,this.#i=!1}else{let s=a.conString||process.env.DATABASE_URL,o=a.conObject;o||(o={},s&&(o.connectionString=s)),this.#e=new(_c()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}a.pruneSessionInterval===!1?this.#t=!1:(this.#t=(a.pruneSessionInterval||900)*1e3,a.pruneSessionRandomizedInterval!==!1&&(this.#u=a.pruneSessionRandomizedInterval||(s=>Math.ceil(s/2+s*Math.random()))))}async _rawEnsureSessionStoreTable(){let a=this.quotedTable(),s=await this._asyncQuery("SELECT to_regclass($1::text)",[a],!0);if(s&&s.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',a);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(a){if(!(a||this.#l===!1))return this.#s||(this.#s=this._rawEnsureSessionStoreTable()),this.#s}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let a=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},a),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(a){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[j_()],s=>{if(a&&typeof a=="function")return a(s);s&&this.#o("Failed to prune sessions:",s),this.#d(),this.#n()})}quotedTable(){let a='"'+this.#r+'"';return this.#a&&(a='"'+this.#a+'".'+a),a}#f(a){let s;if(a&&a.cookie&&a.cookie.expires){let o=new Date(a.cookie.expires);s=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;s=Math.ceil(Date.now()/1e3+o)}return s}async _asyncQuery(a,s,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(a,s);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(a,s);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(a,s,o,u){let c;if(typeof s=="function"){if(o)throw new Error("Two callback functions set at once");o=s,c=[]}else c=s||[];let l=this._asyncQuery(a,c,u);wj(l,o)}get(a,s){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[a,j_()],(o,u)=>{if(o)return s(o);if(!u)return s(null);try{return s(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(a,s)}})}set(a,s,o){this.#n();let u=this.#f(s),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[s,u,a],l=>{o&&o(l)})}destroy(a,s){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[a],o=>{s&&s(o)})}touch(a,s,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(s);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,a],c=>{o&&o(c)})}}return n}});var z_=h((qQ,B_)=>{B_.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,a){n.push(["data",i,a])}),t.on("end",r=function(i,a){n.push(["end",i,a])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,a=n.length;i{function $_(){}$_.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};U_.exports=$_});var Tc=h((am,V_)=>{var H_=Q_();am=V_.exports=H_;am.Strategy=H_});var om=h((RQ,K_)=>{var _j=z_(),Ej=require("util"),G_=Tc();function sm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},G_.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}Ej.inherits(sm,G_);sm.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?_j(t):null;this._deserializeUser(n,t,function(a,s){if(a)return r.error(a);if(!s)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=s}r.pass(),i&&i.resume()})}else r.pass()};K_.exports=sm});var J_=h((DQ,Z_)=>{var W_=$n();function cm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}cm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,a=t.session;t.session.re
2026-01-15 16:57:56.99
1e6c7d01
User
/home/runner/workspace/dist/index.cjs:70
2026-01-15 16:57:56.99
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
2026-01-15 16:57:57.00
1e6c7d01
System
command finished with error [node ./dist/index.cjs]: exit status 1
2026-01-15 16:57:58.26
1e6c7d01
User
Seeding database...
2026-01-15 16:57:58.40
1e6c7d01
User
generate(function(s){if(s)return n(s);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&W_(t.session,a),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};cm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(a){if(a)return r(a);t.session.regenerate(function(s){if(s)return r(s);e.keepSessionInfo&&W_(t.session,i),r()})})};Z_.exports=cm});var um=h((X_,Y_)=>{var Ei=X_=Y_.exports={};Ei.login=Ei.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var a=this;this._sessionManager.logIn(this,t,e,function(s){if(s)return a[n]=null,r(s);r()})}else r&&r()};Ei.logout=Ei.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Ei.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Ei.isUnauthenticated=function(){return!this.isAuthenticated()}});var t8=h((MQ,e8)=>{var Cc=um();e8.exports=function(e,r){return r=r||{},function(i,a,s){i.login=i.logIn=i.logIn||Cc.logIn,i.logout=i.logOut=i.logOut||Cc.logOut,i.isAuthenticated=i.isAuthenticated||Cc.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||Cc.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),s()}}});var i8=h((FQ,n8)=>{function r8(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}r8.prototype.__proto__=Error.prototype;n8.exports=r8});var o8=h((LQ,s8)=>{var a8=require("http"),Ac=um(),kj=i8();s8.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var a=!0;return Array.isArray(r)||(r=[r],a=!1),function(o,u,c){o.login=o.logIn=o.logIn||Ac.logIn,o.logout=o.logOut=o.logOut||Ac.logOut,o.isAuthenticated=o.isAuthenticated||Ac.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||Ac.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(a){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var y=l[0]||{},v=y.challenge||{},x;if(n.failureFlash){var w=n.failureFlash;typeof w=="string"&&(w={type:"error",message:w}),w.type=w.type||"error";var k=w.type||v.type||"error";x=w.message||v.message||v,typeof x=="string"&&o.flash(k,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=v.message||v),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var S=[],P,$,M=0,I=l.length;M{var Tj=t8(),Cj=o8();c8=u8.exports=function(){return{initialize:Tj,authenticate:Cj}}});var d8=h((BQ,p8)=>{var Aj=om(),Pj=J_();function xt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}xt.prototype.init=function(){this.framework(l8()()),this.use(new Aj({key:this._key},this.deserializeUser.bind(this))),this._sm=new Pj({key:this._key},this.serializeUser.bind(this))};xt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};xt.prototype.unuse=function(t){return delete this._strategies[t],this};xt.prototype.framework=function(t){return this._framework=t,this};xt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};xt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};xt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};xt.prototype.session=function(t){return this.authenticate("session",t)};xt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[s];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[s];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){a(s+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};xt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function a(s,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[s];if(!c)return r(null,n);function l(f,y){a(s+1,f,y)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};xt.prototype._strategy=function(t){return this._strategies[t]};p8.exports=xt});var h8=h((fn,m8)=>{var f8=d8(),Ij=om();fn=m8.exports=new f8;fn.Passport=fn.Authenticator=f8;fn.Strategy=Tc();fn.strategies={};fn.strategies.SessionStrategy=Ij});var g8=h(v8=>{v8.lookup=function(t,e){if(!t)return null;for(var r=e.split("]").join("").split("["),n=0,i=r.length;n"u")return null;if(typeof a!="object")return a;t=a}return null}});var b8=h(($Q,x8)=>{var y8=Tc(),Nj=require("util"),Pc=g8().lookup;function lm(t,e){if(typeof t=="function"&&(e=t,t={}),!e)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=t.usernameField||"username",this._passwordField=t.passwordField||"password",y8.Strategy.call(this),this.name="local",this._verify=e,this._passReqToCallback=t.passReqToCallback}Nj.inherits(lm,y8.Strategy);lm.prototype.authenticate=function(t,e){e=e||{};var r=Pc(t.body,this._usernameField)||Pc(t.query,this._usernameField),n=Pc(t.body,this._passwordField)||Pc(t.query,this._passwordField);if(!r||!n)return this.fail({message:e.badRequestMessage||"Missing credentials"},400);var i=this;function a(s,o,u){if(s)return i.error(s);if(!o)return i.fail(u);i.success(o,u)}try{i._passReqToCallback?this._verify(t,r,n,a):this._verify(r,n,a)}catch(s){return i.error(s)}};x8.exports=lm});var _8=h((pm,S8)=>{var w8=b8();pm=S8.exports=w8;pm.Strategy=w8});var Dj={};hm(Dj,{log:()=>mm});module.exports=z8(Dj);var Ic=bt(Bl(),1);var qd={};hm(qd,{favorites:()=>At,insertFavoriteSchema:()=>J9,insertItemSchema:()=>nc,insertRentalSchema:()=>Od,insertUserSchema:()=>Nd,items:()=>j,rentals:()=>ue,users:()=>Ce});var m=Symbol.for("drizzle:entityKind"),YD=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??""}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(m in r&&r[m]===e[m])return!0;r=Object.getPrototypeOf(r)}return!1}var Z=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var _o=class{static[m]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var Eo=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:a}=e();return{name:n,columns:i,foreignTable:a[0].table,foreignColumns:a}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zl(e,this)}},zl=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),a=n.map(o=>o.name),s=[this.table[jt],...i,n[0].table[jt],...a];return e??`${s.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Ql(t,e){return`${t[jt]}_${e.join("_")}_unique`}var $l=class{constructor(e,r){this.name=r,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ul(e,this.columns,this.nullsNotDistinctConfig,this.name)}},E0=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new $l(e,this.name)}},Ul=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Ql(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=n}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function k0(t,e,r){for(let n=e;nArray.isArray(e)?Hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var O=class extends _o{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new Gl(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((a,s)=>{let o=new Eo(()=>{let u=a();return{columns:[e],foreignColumns:[u]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Vl(e,this.config)}},E=class extends Z{constructor(e,r){r.uniqueName||(r.uniqueName=Ql(e,[r.name])),super(e,r),this.table=e}static[m]="PgColumn"},Vl=class extends E{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},A0=class{static[m]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Gl=class extends O{static[m]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new Kl(e,this.config,r)}},Kl=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=C0(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:b(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Hl(n)}};var P0=Symbol.for("drizzle:isPgEnum");function N0(t){return!!t&&typeof t=="function"&&P0 in t&&t[P0]===!0}var I0=class extends O{static[m]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Wl(e,this.config)}},Wl=class extends E{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var ke=class{static[m]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Zn=class extends ke{static[m]="WithSubquery"};var O0="0.39.3";var Zl,Jl,ae={startActiveSpan(t,e){return Zl?(Jl||(Jl=Zl.trace.getTracer("drizzle-orm",O0)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),Zl,Jl)):e()}};var se=Symbol.for("drizzle:ViewBaseConfig");var To=Symbol.for("drizzle:Schema"),Co=Symbol.for("drizzle:Columns"),q0=Symbol.for("drizzle:ExtraConfigColumns"),Xl=Symbol.for("drizzle:OriginalName"),Yl=Symbol.for("drizzle:BaseName"),wa=Symbol.for("drizzle:IsAlias"),j0=Symbol.for("drizzle:ExtraConfigBuilder"),R0=Symbol.for("drizzle:IsDrizzleTable"),C=class{static[m]="Table";static Symbol={Name:jt,Schema:To,OriginalName:Xl,Columns:Co,ExtraConfigColumns:q0,BaseName:Yl,IsAlias:wa,ExtraConfigBuilder:j0};[jt];[Xl];[To];[Co];[q0];[Yl];[wa]=!1;[R0]=!0;[j0]=void 0;constructor(e,r,n){this[jt]=this[Xl]=e,this[To]=r,this[Yl]=n}};function ep(t){return typeof t=="object"&&t!==null&&R0 in t}function at(t){return t[jt]}function Ur(t){return`${t[To]??"public"}.${t[jt]}`}var D0=class{static[m]="FakePrimitiveParam"};function tp(t){return t!=null&&typeof t.getSQL=="function"}function bP(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new N([this])}},N=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=F0;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ae.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return bP(e.map(l=>{if(b(l,Te))return{sql:l.value.join(""),params:[]};if(b(l,Sa))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Te("(")];for(let[d,f]of l.entries())p.push(f),dt},L0={mapToDriverValue:t=>t},$M={...F0,...L0},st=class{constructor(e,r=L0){this.value=e,this.encoder=r}static[m]="Param";brand;getSQL(){return new N([this])}};function g(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new N(r)}(t=>{function e(){return new N([])}t.empty=e;function r(u){return new N(u)}t.fromList=r;function n(u){return new N([new Te(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new N(l)}t.join=i;function a(u){return new Sa(u)}t.identifier=a;function s(u){return new Zt(u)}t.placeholder=s;function o(u,c){return new st(u,c)}t.param=o})(g||(g={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(N||(N={}));var Zt=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new N([this])}};function rp(t,e){return t.map(r=>{if(b(r,Zt)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(b(r,st)&&b(r.value,Zt)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var B0=Symbol.for("drizzle:IsDrizzleView"),Ze=class{static[m]="View";[se];[B0]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[se]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new N([this])}};function z0(t){return typeof t=="object"&&t!==null&&B0 in t}Z.prototype.getSQL=function(){return new N([this])};C.prototype.getSQL=function(){return new N([this])};ke.prototype.getSQL=function(){return new N([this])};var Qr=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Jn=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[m]="TableAliasProxyHandler";get(e,r){if(r===C.Symbol.IsAlias)return!0;if(r===C.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===C.Symbol.OriginalName)return this.alias;if(r===se)return{...e[se],name:this.alias,isAlias:!0};if(r===C.Symbol.Columns){let i=e[C.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new Qr(new Proxy(e,this)))}),a}let n=e[r];return b(n,Z)?new Proxy(n,new Qr(new Proxy(e,this))):n}},$0=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?_a(e.sourceTable,this.alias):e[r]}};function _a(t,e){return new Proxy(t,new Jn(e,!1))}function Qt(t,e){return new Proxy(t,new Qr(new Proxy(t.table,new Jn(e,!1))))}function np(t,e){return new N.Aliased(Ea(t.sql,e),t.fieldAlias)}function Ea(t,e){return g.join(t.queryChunks.map(r=>b(r,Z)?Qt(r,e):b(r,N)?Ea(r,e):b(r,N.Aliased)?np(r,e):r))}function U0(t,e,r){let n={},i=t.reduce((a,{path:s,field:o},u)=>{let c;b(o,Z)?c=o:b(o,N)?c=o.decoder:c=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p0)for(let[a,s]of Object.entries(n))typeof s=="string"&&!r[s]&&(i[a]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let a=e?[...e,n]:[n];return b(i,Z)||b(i,N)||b(i,N.Aliased)?r.push({path:a,field:i}):b(i,C)?r.push(...kt(i[C.Symbol.Columns],a)):r.push(...kt(i,a)),r},[])}function ka(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,a]of r.entries())if(a!==n[i])return!1;return!0}function Ao(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>b(i,N)||b(i,Z)?[n,i]:[n,new st(i,t[C.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Q0(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Po(t){return t[C.Symbol.Columns]}function H0(t){return t[se].selectedFields}function Jt(t){return b(t,ke)?t._.alias:b(t,Ze)?t[se].name:b(t,N)?void 0:t[C.Symbol.IsAlias]?t[C.Symbol.Name]:t[C.Symbol.BaseName]}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function V0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Xt=class extends O{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ip=class extends Xt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ap(e,this.config)}},ap=class extends E{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},sp=class extends Xt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new op(e,this.config)}},op=class extends E{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function G0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new ip(r):new sp(r)}var cp=class extends O{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new up(e,this.config)}},up=class extends E{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},lp=class extends O{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new pp(e,this.config)}},pp=class extends E{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function K0(t,e){let{name:r,config:n}=V(t,e);return n.mode==="number"?new cp(r):new lp(r)}var dp=class extends O{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new fp(e,this.config)}},fp=class extends E{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Io(t){return new dp(t??"")}var mp=class extends O{static[m]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new hp(e,this.config)}},hp=class extends E{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function W0(t,e={}){let{name:r,config:n}=V(t,e);return new mp(r,n)}var vp=class extends O{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new gp(e,this.config)}},gp=class extends E{static[m]="PgCidr";getSQLType(){return"cidr"}};function Z0(t){return new vp(t??"")}var yp=class extends O{static[m]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new xp(e,this.config)}},xp=class extends E{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function J0(t){return(e,r)=>{let{name:n,config:i}=V(e,r);return new yp(n,i,t)}}var Ht=class extends O{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(g`now()`)}};var bp=class extends Ht{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ta(e,this.config)}},Ta=class extends E{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},wp=class extends Ht{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Ca(e,this.config)}},Ca=class extends E{static[m]="PgDateString";getSQLType(){return"date"}};function X0(t,e){let{name:r,config:n}=V(t,e);return n?.mode==="date"?new bp(r):new wp(r)}var Sp=class extends O{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _p(e,this.config)}},_p=class extends E{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Y0(t){return new Sp(t??"")}var Ep=class extends O{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new kp(e,this.config)}},kp=class extends E{static[m]="PgInet";getSQLType(){return"inet"}};function ew(t){return new Ep(t??"")}var Tp=class extends Xt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Cp(e,this.config)}},Cp=class extends E{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new Tp(t??"")}var Ap=class extends O{static[m]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Pp(e,this.config)}},Pp=class extends E{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function tw(t,e={}){let{name:r,config:n}=V(t,e);return new Ap(r,n)}var Ip=class extends O{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Aa(e,this.config)}},Aa=class extends E{static[m]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function rw(t){return new Ip(t??"")}var Np=class extends O{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Pa(e,this.config)}},Pa=class extends E{static[m]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function nw(t){return new Np(t??"")}var Op=class extends O{static[m]="PgLineBuilder";constr
